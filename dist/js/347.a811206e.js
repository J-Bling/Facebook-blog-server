"use strict";(self["webpackChunksimple_blog"]=self["webpackChunksimple_blog"]||[]).push([[347],{9728:function(e,t,a){a.r(t),a.d(t,{default:function(){return oe}});var l=a(6768),s=a(4232),n=a(5130);const o={key:0,class:"post-main"},i={class:"post-card"},c={class:"content-main"},r={class:"title"},u={class:"body"},m={class:"bottom"},d={class:"metadata"},p={class:"create-time"},v={class:"views"},k={key:0,class:"author"},g=["src"],y={class:"name"},b={class:"comments-main"},_={key:0,class:"comments-section"},h={key:1,class:"comments-disabled"};function L(e,t,a,L,C,f){const w=(0,l.g2)("router-link"),S=(0,l.g2)("GetComments");return L.post?((0,l.uX)(),(0,l.CE)("div",o,[(0,l.Lk)("div",i,[(0,l.Lk)("div",c,[(0,l.Lk)("p",r,[(0,l.Lk)("strong",null,(0,s.v_)(L.post.title),1)]),(0,l.Lk)("pre",u,(0,s.v_)(L.post.content),1)]),t[2]||(t[2]=(0,l.Lk)("hr",null,null,-1)),(0,l.Lk)("div",m,[(0,l.Lk)("div",d,[(0,l.Lk)("span",p,(0,s.v_)(L.change_date(L.post.create_time)),1),t[1]||(t[1]=(0,l.eW)(" | ")),(0,l.Lk)("span",v,"浏览 "+(0,s.v_)(L.post.views_count),1)]),L.post.author?((0,l.uX)(),(0,l.CE)("div",k,[(0,l.bF)(w,{to:`/Athor/${L.post.author.id}`},{default:(0,l.k6)((()=>[(0,l.Lk)("img",{src:L.post.author.image,alt:"Author Image",class:"author-image",loading:"lazy"},null,8,g)])),_:1},8,["to"]),(0,l.Lk)("p",y,[(0,l.Lk)("em",null,(0,s.v_)(L.post.author.username),1)])])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",b,[(0,l.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>L.toggleComments&&L.toggleComments(...e)),id:"offShow"},"^ 查看评论"),(0,l.bF)(n.eB,{name:"fade"},{default:(0,l.k6)((()=>[L.isCommentsVisible&&L.post.comments_status?((0,l.uX)(),(0,l.CE)("div",_,[(0,l.bF)(S,{postId:L.postId},null,8,["postId"])])):L.post.comments_status?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",h," 作者关闭了评论区 "))])),_:1})])])])):(0,l.Q3)("",!0)}var C=a(144),f=a(7361),w=a(1387),S=a(8153),F=a(4646),R=a(7589);const x={class:"comments-main"},I={key:0,class:"comments-list"},V={class:"header-comments"},$={class:"comment-header"},X=["src"],A={class:"commenter-name"},E={class:"comment-create-time"},K={class:"comment-body"},D={class:"comment-content"},z={class:"comment-actions"},G=["onClick","disabled"],J=["onClick"],Q={class:"replys"},U={key:0},W={class:"comment-header"},j=["src"],q={class:"replyer-name"},B={class:"reply-create-time"},H={class:"reply-body"},M={class:"reply-content"},Y={class:"reply-actions"},N=["onClick","disabled"],T={style:{display:"flex","margin-top":"16px"}},O=["onClick"],P={class:"create-comment"},Z={style:{display:"flex"}};var ee={__name:"GetComments",props:{postId:{type:[String,Number],required:!0}},setup(e){const t=e,a=t.postId,o=(0,f.j)(),i=(0,R.J)(),c=(0,C.KR)([]),r=(0,C.KR)(""),u=(0,C.KR)(!1),m=(0,C.KR)(!0),d=(0,C.KR)(null),p=(0,C.KR)({isShowReplys:!1,ReplyContent:"",isSending:!1,isSendingAgree:!1}),v=(0,C.KR)(-1),k=async()=>{let e=`${o.comment_list}/${a}/1`;const t=await(0,S.J)(e);t&&(c.value=t.data.slice().sort(((e,t)=>new Date(e.create_time)<new Date(t.create_time))))},g=async()=>{if(!r.value.trim().length)return(0,F.l)("不能发送空内容!!!","",1500),null;u.value=!0;const e=`${o.create_comment}/${a}`,t=await(0,S.b)(e,{content:r.value});t&&((0,F.l)("发布成功","等待审核中",1500),r.value="",(0,l.dY)((()=>{d.value&&d.value.wrap&&d.value.setScrollTop(d.value.wrap.scrollHeight)}))),u.value=!1},y=e=>{try{const t=new Date(e);return t.toLocaleDateString()}catch(t){return e}},b=async(e,t,a)=>{p.value.isSendingAgree=!0;const l=o.comment_agree+"/"+e,s=await(0,S.J)(l);s&&("no"===a?c.value[t].agree++:c.value[t].replys[a].agree++),p.value.isSendingAgree=!1},_=e=>{v.value=e},h=e=>{v.value===e&&(v.value=-1)},L=async(e,t)=>{p.value.isSending=!0;const a=o.create_commentComments+"/"+e,l=await(0,S.b)(a,{content:p.value.ReplyContent});l&&(0,F.l)("回复成功","等待审核中",1500),p.value.ReplyContent="",p.value.isSending=!1};return(0,l.sV)((async()=>{await k(),i.initData()})),(0,l.wB)((()=>m.value),(e=>{c.value=e?c.value.sort(((e,t)=>e.agree>t.agree)):c.value.sort(((e,t)=>e.create_time>t.create_time))})),(e,t)=>{const a=(0,l.g2)("el-switch"),o=(0,l.g2)("router-link"),i=(0,l.g2)("el-input"),k=(0,l.g2)("el-button"),C=(0,l.g2)("el-scrollbar"),f=(0,l.g2)("el-empty");return(0,l.uX)(),(0,l.CE)("div",x,[c.value.length>0?((0,l.uX)(),(0,l.CE)("div",I,[(0,l.Lk)("div",V,[(0,l.Lk)("span",null,(0,s.v_)(c.value.length)+"条评论",1),(0,l.bF)(a,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=e=>m.value=e),"active-text":"最新","inactive-text":"最热"},null,8,["modelValue"])]),(0,l.bF)(C,{"max-height":"400px",ref_key:"scrollbarRef",ref:d},{default:(0,l.k6)((()=>[(0,l.bF)(n.F,{name:"comment-list-transition",tag:"div",class:"comment-list"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(c.value,((e,a)=>((0,l.uX)(),(0,l.CE)("div",{class:"comment",key:a},[(0,l.Lk)("div",$,[(0,l.bF)(o,{to:`/Athor/${e.author.id}`,class:"commenter-info"},{default:(0,l.k6)((()=>[(0,l.Lk)("img",{src:e.author.image,alt:"User Image",class:"commenter-image"},null,8,X),(0,l.Lk)("span",A,(0,s.v_)(e.author.name),1)])),_:2},1032,["to"]),(0,l.Lk)("span",E,(0,s.v_)(y(e.create_time)),1)]),(0,l.Lk)("div",K,[(0,l.Lk)("p",D,(0,s.v_)(e.content),1)]),(0,l.Lk)("div",z,[(0,l.Lk)("button",{class:"action-button",onClick:t=>b(e.id,a,"no"),disabled:p.value.isSendingAgree},(0,s.v_)(e.agree)+" 人赞同 ",9,G),(0,l.Lk)("button",{class:"action-button",onClick:e=>_(a)},"查看 "+(0,s.v_)(e.replys.length)+" 条回复",9,J)]),(0,l.bo)((0,l.Lk)("div",Q,[t[4]||(t[4]=(0,l.Lk)("hr",null,null,-1)),e.replys.length?((0,l.uX)(),(0,l.CE)("div",U,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.replys,((e,t)=>((0,l.uX)(),(0,l.CE)("div",{class:"reply",key:t},[(0,l.Lk)("div",W,[(0,l.bF)(o,{to:`/Athor/${e.author._id}`,style:{"text-decoration":"none",color:"black"},class:"reply-info"},{default:(0,l.k6)((()=>[(0,l.Lk)("img",{src:e.author.image,class:"replyer-image"},null,8,j),(0,l.Lk)("span",q,(0,s.v_)(e.author.name),1)])),_:2},1032,["to"]),(0,l.Lk)("span",B,(0,s.v_)(y(e.create_time)),1)]),(0,l.Lk)("div",H,[(0,l.Lk)("p",M,(0,s.v_)(e.content),1)]),(0,l.Lk)("div",Y,[(0,l.Lk)("button",{class:"reply-action-button",onClick:l=>b(e.id,a,t),disabled:p.value.isSendingAgree},(0,s.v_)(e.agree)+" 人赞同 ",9,N)])])))),128))])):(0,l.Q3)("",!0),(0,l.Lk)("div",T,[(0,l.bF)(i,{type:"text",modelValue:p.value.ReplyContent,"onUpdate:modelValue":t[1]||(t[1]=e=>p.value.ReplyContent=e),placeholder:"理性发言,友好互动",autosize:"","min-rows":3,"max-rows":10,style:{width:"100%","margin-right":"8px"}},null,8,["modelValue"]),(0,l.bF)(k,{type:"primary",onClick:t=>L(e.id,a),disabled:p.value.isSending,style:{"font-size":"1.3em"}},{default:(0,l.k6)((()=>t[3]||(t[3]=[(0,l.eW)("回复")]))),_:2},1032,["onClick","disabled"])]),(0,l.Lk)("button",{class:"Collapse",onClick:e=>h(a)},"^ 收起",8,O)],512),[[n.aG,v.value===a]])])))),128))])),_:1})])),_:1},512),t[5]||(t[5]=(0,l.Lk)("div",{class:"comment-bottom"},null,-1))])):((0,l.uX)(),(0,l.Wv)(f,{key:1,description:"更多留言等你来说"})),(0,l.Lk)("div",P,[(0,l.Lk)("div",Z,[(0,l.bF)(i,{type:"textarea",modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=e=>r.value=e),placeholder:"理性发言,友好互动",autosize:"","min-rows":3,"max-rows":10,style:{width:"100%","margin-right":"8px"}},null,8,["modelValue"]),(0,l.bF)(k,{type:"primary",onClick:g,disabled:u.value,style:{"font-size":"1.3em"}},{default:(0,l.k6)((()=>t[6]||(t[6]=[(0,l.eW)("评论")]))),_:1},8,["disabled"])])])])}}},te=a(1241);const ae=(0,te.A)(ee,[["__scopeId","data-v-18552871"]]);var le=ae,se={components:{GetComments:le},setup(){const e=(0,f.j)(),t=(0,w.rd)(),a=(0,w.lq)(),s=a.params.postId,n=(0,C.KR)({}),o=(0,C.KR)(!1),i=async()=>{let a=e.postDetail+`/${s}`;const l=await(0,S.J)(a);l?n.value=l.data:t.replace({path:"/404"})},c=()=>{o.value=!o.value},r=e=>{try{const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}catch(t){return e}};return(0,l.sV)((async()=>{await i()})),{post:n,change_date:r,postId:s,isCommentsVisible:o,toggleComments:c}}};const ne=(0,te.A)(se,[["render",L],["__scopeId","data-v-cdb69f1e"]]);var oe=ne}}]);
//# sourceMappingURL=347.a811206e.js.map