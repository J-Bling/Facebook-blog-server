"use strict";(self["webpackChunksimple_blog"]=self["webpackChunksimple_blog"]||[]).push([[330],{7361:function(e,s,t){t.d(s,{j:function(){return n}});var r=t(2261);const n=(0,r.nY)("urls",{state:()=>({login:"user/login",register:"user/register",send_code:"user/send-code",postsList:"post/postsList",postDetail:"post/postDetail",userPosts:"post/userPosts",MyAuthorPost:"post/my-post",deletePost:"post/delete",create_post:"post/create-post",updatePost:"post/update",comment_list:"comment/comment-list",create_comment:"comment/create_comment",ai_kimi:"ai/kimi",ai_kimi_:"ai/kimi_",ai_qianwen:"ai/qianwen",my_comments:"comment/my-comments",deleteComments:"comment/deleteComments",create_commentComments:"comment/create-commentComments",comment_agree:"comment/comment_agree",user:"users/user",athor:"users/Athor",send_friend_app:"users/send-app",agree_friend_app:"users/agree-app",get_friend_app:"users/FriendsApp",get_friends_list:"users/get-FriendsList",FriendsDynamic:"users/FriendsDynamic",deleteFriend:"users/delete-friend",HistoryMessage:"users/HistoryMessage",weather:"weather/test",views:"count/views"})})},5330:function(e,s,t){t.r(s),t.d(s,{default:function(){return L}});var r=t(6768),n=t(4232),a=t(5130);const i={class:"chat-main-page"},o=["src"],l={key:1,class:"message aiMessage"},u=["src"],c=["href"],m={key:0,class:"content"},d=["src"],p={class:"message userMessage"},g=["src"],f={class:"message aiMessage"};function y(e,s,t,y,v,h){const b=(0,r.g2)("el-card"),k=(0,r.g2)("el-scrollbar"),_=(0,r.g2)("el-container"),w=(0,r.g2)("el-input"),C=(0,r.g2)("el-button"),S=(0,r.g2)("el-footer");return(0,r.uX)(),(0,r.CE)("div",i,[(0,r.Lk)("div",{class:(0,n.C4)(["floating-button",[y.isKimi?"Comment_":"Super_"]]),onClick:s[0]||(s[0]=e=>y.isKimi=!y.isKimi)},(0,n.v_)(y.isKimi?"普通":"超级")+"模式 ",3),(0,r.bF)(_,{class:"content-main"},{default:(0,r.k6)((()=>[(0,r.bF)(k,{ref:"scrollbarRef","wrap-class":"scrollbar-wrapper",class:"chat-main-div"},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(y.MessageQueues,((e,s)=>((0,r.uX)(),(0,r.CE)("div",{class:"content",key:s},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e,((e,s)=>((0,r.uX)(),(0,r.CE)("div",{class:"chat-div",key:s},[(0,r.bF)(b,{class:(0,n.C4)(["chat-card",{ai:"ai"===e.user,user:"user"===e.user}])},{header:(0,r.k6)((()=>[(0,r.Lk)("span",null,[(0,r.Lk)("img",{src:"user"===e.user?y.userImage:y.aiImage,class:(0,n.C4)(["image","user"===e.user?"userImage":"aiImage"])},null,10,o)])])),default:(0,r.k6)((()=>["string"===typeof e.message?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,n.C4)(["message","user"===e.user?"userMessage":"aiMessage"])},[(0,r.Lk)("pre",null,(0,n.v_)(e.message),1)],2)):((0,r.uX)(),(0,r.CE)("div",l,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.message.links,((e,s)=>((0,r.uX)(),(0,r.CE)("p",{key:s},[(0,r.Lk)("img",{src:e.logo,class:"logo",width:"20px"},null,8,u),(0,r.Lk)("a",{href:e.url,class:"url-title"},(0,n.v_)(e.title),9,c)])))),128))]))])),_:2},1032,["class"])])))),128))])))),128)),y.TemporaryQueues.length>0?((0,r.uX)(),(0,r.CE)("div",m,[(0,r.bF)(b,{class:"chat-card user"},{header:(0,r.k6)((()=>[(0,r.Lk)("span",null,[(0,r.Lk)("img",{src:y.userImage,class:"userImage image"},null,8,d)])])),default:(0,r.k6)((()=>[(0,r.Lk)("div",p,[(0,r.Lk)("pre",null,(0,n.v_)(y.TemporaryQueues[0].message),1)])])),_:1}),y.streamData?((0,r.uX)(),(0,r.Wv)(b,{key:0,class:"chat-card ai"},{header:(0,r.k6)((()=>[(0,r.Lk)("span",null,[(0,r.Lk)("img",{src:y.aiImage,class:"image aiImage"},null,8,g)])])),default:(0,r.k6)((()=>[(0,r.Lk)("div",f,[(0,r.Lk)("pre",null,(0,n.v_)(y.streamData),1)])])),_:1})):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0)])),_:1},512)])),_:1}),(0,r.bF)(S,{class:"input"},{default:(0,r.k6)((()=>[(0,r.Lk)("form",{onSubmit:s[2]||(s[2]=(0,a.D$)(((...s)=>e.handleSubmit&&e.handleSubmit(...s)),["prevent"])),class:"message-form"},[(0,r.bF)(w,{class:"user-input",type:"textarea",modelValue:y.UserContent,"onUpdate:modelValue":s[1]||(s[1]=e=>y.UserContent=e),placeholder:"请输入内容",autosize:"",minrows:3,maxrows:10,style:{"flex-grow":"1","margin-right":"8px"},onKeyup:(0,a.jR)(y.handleEnter,["enter"])},null,8,["modelValue","onKeyup"]),(0,r.bF)(C,{class:"user-button",type:"primary","native-type":"submit",disabled:y.isSending||!y.UserContent.length,style:(0,n.Tr)({backgroundColor:y.isSending||!y.UserContent?"#cccccc":"#409EFF",color:"#ffffff"})},{default:(0,r.k6)((()=>s[3]||(s[3]=[(0,r.eW)(" 发送 ")]))),_:1},8,["disabled","style"])],32)])),_:1})])}var v=t(1114),h=(t(4114),t(144)),b=t(7361),k=t(4646),_=t(7589),w={setup(){const e=(0,b.j)(),s=(0,_.J)(),t="https://tse4-mm.cn.bing.net/th/id/OIP-C.j8q9H_Obm-af9tFzui7LdAHaHV?rs=1&pid=ImgDetMain",n=s.user_data.image||"https://tse3-mm.cn.bing.net/th/id/OIP-C.HXHAQvjrX1gCRlcANzmqPgAAAA?rs=1&pid=ImgDetMain",a="http://192.168.211.81:7001/api/",i=(0,h.KR)([]),o=(0,h.KR)([]),l=(0,h.KR)(""),u=(0,h.KR)(""),c=(0,h.KR)(!0),m=(0,h.KR)(!1),d=(0,h.KR)(null);function p(){(0,r.dY)((()=>{const e=d.value;if(e&&e.$el&&e.$el.querySelector&&e.$el.querySelector(".scrollbar-wrapper")){const s=e.$el.querySelector(".scrollbar-wrapper");s.scrollTop=s.scrollHeight}else console.log("scrollbarRef is undefined or .wrap is undefined")}))}const g=()=>{const e=l.value.slice(),s={user:"user",message:e};f(s),l.value="",(0,r.dY)(p())},f=e=>{o.value.push(e)},y=()=>{i.value.push(o.value),o.value=[],u.value="",(0,r.dY)(p())};function w(e){function s(){const e=l.value.indexOf("\n",l.value.length-1),s=l.value.slice(0,e)+"\n"+l.value.slice(e+1);l.value=s}e.shiftKey?s():!m.value&&C(l.value)?I():s()}function C(e){return e.trim().replace(/\s+/g," ")}function S(e){try{const s=JSON.parse(e);return s.text}catch(s){return null}}function L(e){try{const s=JSON.parse(e);return s.contents.pop().content}catch(s){return null}}class K{constructor(){(0,v.A)(this,"spider_kimi",(async(e,s)=>{try{const t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s})});if(!t.ok)return null;const n=t.body.getReader(),a=new TextDecoder("utf-8");let i=!0;while(i){const{done:e,value:s}=await n.read();if(e)break;const t=a.decode(s,{stream:!0}).split("data: ");for(let n of t)if(n){const e=S(n);if(e){if("Kimi助手功能介绍"===e)continue;u.value+=e,(0,r.dY)(p())}}}return n.releaseLock(),u.value}catch(t){return console.log("error",t),null}})),(0,v.A)(this,"kimi",(async s=>{g();const t=a+e.ai_kimi_;try{const e=await this.spider_kimi(t,s);var r;r=e?{user:"ai",message:e.slice()}:{user:"ai",message:"刚刚网络出错误,请重新连接 (｡ì _ í｡)"},f(r),y()}catch(n){console.log("error",n),(0,k.l)("网络出错","")}})),(0,v.A)(this,"spider_qianwen",(async(e,s)=>{try{const t=await fetch(e,{method:"POST",body:JSON.stringify({content:s}),headers:{"Content-Type":"application/json"}});if(!t)return null;const n=t.body.getReader(),a=new TextDecoder("utf-8");for(;;){const{done:e,value:s}=await n.read();if(e)break;const t=a.decode(s,{stream:!0});if(t){const e=t.split("data: ");for(let s of e)if(s){const e=L(s);e&&(u.value=e,(0,r.dY)(p()))}}}return n.releaseLock(),F(u.value)}catch(t){return console.log("fetch_error :",t),null}})),(0,v.A)(this,"qianwen",(async s=>{const t=a+e.ai_qianwen;g();try{const e=await this.spider_qianwen(t,s);var r;r=e?{user:"ai",message:e}:{user:"ai",message:"刚刚网络出错误,请重新连接 (｡ì _ í｡)"},f(r),y()}catch(n){console.log("error",n),(0,k.l)("网络出错","")}}))}}const F=e=>{try{const s=JSON.parse(e);return s}catch(s){return e}},I=async()=>{try{const e=C(l.value);if(!e)return(0,k.l)("不能发生空内容","",1500),null;m.value=!0;const s=new K;c.value?await s.kimi(e):await s.qianwen(e)}catch(e){console.log("error",e),(0,k.l)("出错了","",1500)}finally{m.value=!1,u.value=""}};return(0,r.sV)((function(){i.value.push([{user:"ai",message:"^-^ :你好请问有什么可以帮到你"}]),p()})),{handleEnter:w,streamData:u,isKimi:c,MessageQueues:i,TemporaryQueues:o,UserContent:l,send:I,aiImage:t,userImage:n,isSending:m,scrollbarRef:d}}},C=t(1241);const S=(0,C.A)(w,[["render",y],["__scopeId","data-v-4e0f51c9"]]);var L=S},1114:function(e,s,t){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e,s){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,s||"default");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}function a(e){var s=n(e,"string");return"symbol"==r(s)?s:s+""}function i(e,s,t){return(s=a(s))in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}t.d(s,{A:function(){return i}})}}]);
//# sourceMappingURL=330.fd8559cf.js.map